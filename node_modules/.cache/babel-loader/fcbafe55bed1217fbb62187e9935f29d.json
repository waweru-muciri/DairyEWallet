{"ast":null,"code":"var _jsxFileName = \"/home/brianmuciri/Projects/farm-ledger-ld/src/Routes/DashBoard.js\";\nimport React, { useEffect, useState } from \"react\";\nimport Layout from \"../components/PrivateLayout\";\nimport { connect } from \"react-redux\";\nimport PageHeading from \"../components/PageHeading\";\nimport InfoDisplayPaper from \"../components/InfoDisplayPaper\";\nimport Grid from \"@material-ui/core/Grid\";\nimport Typography from \"@material-ui/core/Typography\";\nimport Box from \"@material-ui/core/Box\";\nimport MenuItem from \"@material-ui/core/MenuItem\";\nimport Button from \"@material-ui/core/Button\";\nimport TextField from \"@material-ui/core/TextField\";\nimport SearchIcon from \"@material-ui/icons/Search\";\nimport { Bar } from 'react-chartjs-2';\nimport { commonStyles } from '../components/commonStyles';\nimport * as Yup from \"yup\";\nimport { Formik } from \"formik\";\nimport { format, getYear, startOfYear, endOfYear, startOfToday, parse, eachMonthOfInterval, isSameMonth } from \"date-fns\";\nimport { getUnitTypes } from \"../assets/commonAssets\";\nconst options = {\n  responsive: true,\n  tooltips: {\n    mode: 'label'\n  },\n  elements: {\n    line: {\n      fill: false\n    }\n  },\n  scales: {\n    yAxes: [{\n      ticks: {\n        min: 0\n      }\n    }]\n  }\n};\nconst FilterYearSchema = Yup.object().shape({\n  filter_year: Yup.number().typeError(\"Year must be a number!\").required(\"Year is required\").min(2000, \"Sorry, were not present then.\").max(2100, \"Sorry, but we won't be here during those times.\").integer()\n});\nvar monthsInYear = eachMonthOfInterval({\n  start: startOfYear(startOfToday()),\n  end: endOfYear(startOfToday())\n}); //get the various unit types \n\nconst UNIT_TYPES = getUnitTypes();\nconst currentYear = new Date().getFullYear();\n\nlet DashBoardPage = props => {\n  const classes = commonStyles();\n  const {\n    sales,\n    customerAccountDeposits\n  } = props;\n  const [transactionItems, setSaleItems] = useState([]);\n  const [propertyUnitItems, setPropertyUnitItems] = useState([]);\n  const [leaseItems, setLeaseItems] = useState([]);\n  const [chargesItems, setChargesItems] = useState([]);\n  const propertyActiveLeases = leaseItems.filter(({\n    terminated\n  }) => terminated !== true);\n  useEffect(() => {\n    const rentalChargesForCurrentYear = rentalCharges.filter(({\n      charge_date\n    }) => getYear(parse(charge_date, 'yyyy-MM-dd', new Date())) === currentYear);\n    setChargesItems(rentalChargesForCurrentYear);\n  }, [rentalCharges]);\n  useEffect(() => {\n    const salesPaymentsForCurrentYear = sales.filter(({\n      sale_date\n    }) => getYear(parse(sale_date, 'yyyy-MM-dd', new Date())) === currentYear);\n    setSaleItems(salesPaymentsForCurrentYear);\n  }, [sales]); //GET THE TOTAL NUMBER OF PROPERTY UNITS\n\n  const TOTAL_SALES = sales.reduce((total, currentSale) => total + (parseFloat(currentSale.sale_price) * parseFloat(currentSale.sale_quantity) || 0), 0); // CREATE A UNIT OCCUPANCY DISPLAY DATA ARRAY INSTEAD OF REPEATING MULTIPLE ELEMENTS\n\n  const SALE_SUMMARY_DATA = [{\n    title: \"Total Sales\",\n    value: TOTAL_SALES\n  }, {\n    title: \"Total Credit\",\n    value: 0\n  }]; //GET THE TOTAL PAYMENTS FOR EACH MONTH IN THE SELECTED YEAR\n\n  const totalEachMonthSales = monthsInYear.map(monthDate => {\n    //get sales recorded in the same month and year as monthDate\n    return sales.filter(sale => {\n      const saleDate = parse(sale.sale_date, 'yyyy-MM-dd', new Date());\n      return isSameMonth(monthDate, saleDate);\n    }).reduce((total, currentSale) => total + (parseFloat(currentSale.sale_price) * parseFloat(currentSale.sale_quantity) || 0), 0);\n  }); // MAKE AN OBJECT FOR SHOWING AN INCOME GRAPH, BY MONTH, LATER\n  // LABELS ARE MONTHS IN THE YEAR IN SHORT FORMAT\n\n  const rentIncomeData = {\n    datasets: [{\n      data: totalEachMonthSales,\n      label: 'Monthly Sales',\n      type: 'bar',\n      fill: false,\n      backgroundColor: '#71B37C',\n      borderColor: '#71B37C',\n      hoverBackgroundColor: '#71B37C',\n      hoverBorderColor: '#71B37C'\n    }],\n    labels: monthsInYear.map(monthDate => format(monthDate, 'MMMM'))\n  };\n  const totalEachMonthClientMoney = monthsInYear.map(monthDate => {\n    //get sales recorded in the same month and year as monthDate\n    return customerAccountDeposits.filter(charge => {\n      const chargeDate = parse(charge.charge_date, 'yyyy-MM-dd', new Date());\n      return isSameMonth(monthDate, chargeDate);\n    }).reduce((total, currentSale) => total + (parseFloat(currentSale.charge_amount) || 0), 0);\n  });\n  rentIncomeData.datasets.push({\n    data: totalEachMonthClientMoney,\n    label: 'Monthly Charges',\n    type: 'line',\n    borderColor: '#EC932F',\n    fill: false,\n    backgroundColor: '#EC932F',\n    pointBorderColor: '#EC932F',\n    pointBackgroundColor: '#EC932F',\n    pointHoverBackgroundColor: '#EC932F',\n    pointHoverBorderColor: '#EC932F'\n  });\n  return /*#__PURE__*/React.createElement(Layout, {\n    pageTitle: \"Overview\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 138,\n      columnNumber: 5\n    }\n  }, /*#__PURE__*/React.createElement(Grid, {\n    container: true,\n    justify: \"center\",\n    direction: \"column\",\n    spacing: 4,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 139,\n      columnNumber: 7\n    }\n  }, /*#__PURE__*/React.createElement(Grid, {\n    item: true,\n    key: 0,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 140,\n      columnNumber: 9\n    }\n  }, /*#__PURE__*/React.createElement(PageHeading, {\n    text: \"Overview\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 141,\n      columnNumber: 11\n    }\n  })), /*#__PURE__*/React.createElement(Grid, {\n    item: true,\n    container: true,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 143,\n      columnNumber: 9\n    }\n  }, /*#__PURE__*/React.createElement(Grid, {\n    container: true,\n    item: true,\n    direction: \"column\",\n    spacing: 4,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 144,\n      columnNumber: 11\n    }\n  }, /*#__PURE__*/React.createElement(Grid, {\n    item: true,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 145,\n      columnNumber: 13\n    }\n  }, /*#__PURE__*/React.createElement(Box, {\n    border: 1,\n    borderRadius: \"borderRadius\",\n    borderColor: \"grey.400\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 146,\n      columnNumber: 15\n    }\n  }, /*#__PURE__*/React.createElement(Formik, {\n    initialValues: {\n      filter_year: currentYear\n    },\n    validationSchema: FilterYearSchema,\n    onSubmit: values => {\n      setFilteredSaleItemsByYear(parseInt(values.filter_year));\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 151,\n      columnNumber: 17\n    }\n  }, ({\n    values,\n    handleSubmit,\n    touched,\n    errors,\n    handleChange,\n    handleBlur\n  }) => /*#__PURE__*/React.createElement(\"form\", {\n    className: classes.form,\n    id: \"yearFilterForm\",\n    onSubmit: handleSubmit,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 166,\n      columnNumber: 21\n    }\n  }, /*#__PURE__*/React.createElement(Grid, {\n    container: true,\n    spacing: 2,\n    alignItems: \"center\",\n    justify: \"center\",\n    direction: \"row\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 171,\n      columnNumber: 23\n    }\n  }, /*#__PURE__*/React.createElement(Grid, {\n    item: true,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 178,\n      columnNumber: 25\n    }\n  }, /*#__PURE__*/React.createElement(TextField, {\n    variant: \"outlined\",\n    id: \"filter_year\",\n    name: \"filter_year\",\n    label: \"Year\",\n    value: values.filter_year,\n    onChange: handleChange,\n    onBlur: handleBlur,\n    error: errors.filter_year && touched.filter_year,\n    helperText: touched.filter_year && errors.filter_year,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 179,\n      columnNumber: 27\n    }\n  })), /*#__PURE__*/React.createElement(Grid, {\n    item: true,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 193,\n      columnNumber: 25\n    }\n  }, /*#__PURE__*/React.createElement(Button, {\n    type: \"submit\",\n    form: \"yearFilterForm\",\n    color: \"primary\",\n    variant: \"contained\",\n    size: \"medium\",\n    startIcon: /*#__PURE__*/React.createElement(SearchIcon, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 200,\n        columnNumber: 40\n      }\n    }),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 194,\n      columnNumber: 27\n    }\n  }, \"SEARCH\"))))))))), /*#__PURE__*/React.createElement(Grid, {\n    item: true,\n    container: true,\n    spacing: 2,\n    direction: \"row\",\n    alignItems: \"stretch\",\n    justify: \"space-around\",\n    key: 3,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 213,\n      columnNumber: 9\n    }\n  }), /*#__PURE__*/React.createElement(Grid, {\n    item: true,\n    container: true,\n    spacing: 2,\n    direction: \"row\",\n    alignItems: \"stretch\",\n    justify: \"space-around\",\n    key: 2,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 223,\n      columnNumber: 9\n    }\n  }, SALE_SUMMARY_DATA.map((unitOccupancyData, index) => /*#__PURE__*/React.createElement(InfoDisplayPaper, {\n    key: index,\n    xs: 12,\n    title: unitOccupancyData.title,\n    value: unitOccupancyData.value,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 234,\n      columnNumber: 15\n    }\n  }))), /*#__PURE__*/React.createElement(Grid, {\n    item: true,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 238,\n      columnNumber: 9\n    }\n  }, /*#__PURE__*/React.createElement(Typography, {\n    variant: \"h6\",\n    align: \"center\",\n    gutterBottom: true,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 239,\n      columnNumber: 11\n    }\n  }, \"Monthly Sales & Credit\"), /*#__PURE__*/React.createElement(Bar, {\n    data: rentIncomeData,\n    options: options,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 242,\n      columnNumber: 11\n    }\n  }))));\n};\n\nconst mapStateToProps = state => {\n  return {\n    customerAccountDeposits: state.customerAccountDeposits,\n    sales: state.sales\n  };\n};\n\nexport default connect(mapStateToProps)(DashBoardPage);","map":{"version":3,"sources":["/home/brianmuciri/Projects/farm-ledger-ld/src/Routes/DashBoard.js"],"names":["React","useEffect","useState","Layout","connect","PageHeading","InfoDisplayPaper","Grid","Typography","Box","MenuItem","Button","TextField","SearchIcon","Bar","commonStyles","Yup","Formik","format","getYear","startOfYear","endOfYear","startOfToday","parse","eachMonthOfInterval","isSameMonth","getUnitTypes","options","responsive","tooltips","mode","elements","line","fill","scales","yAxes","ticks","min","FilterYearSchema","object","shape","filter_year","number","typeError","required","max","integer","monthsInYear","start","end","UNIT_TYPES","currentYear","Date","getFullYear","DashBoardPage","props","classes","sales","customerAccountDeposits","transactionItems","setSaleItems","propertyUnitItems","setPropertyUnitItems","leaseItems","setLeaseItems","chargesItems","setChargesItems","propertyActiveLeases","filter","terminated","rentalChargesForCurrentYear","rentalCharges","charge_date","salesPaymentsForCurrentYear","sale_date","TOTAL_SALES","reduce","total","currentSale","parseFloat","sale_price","sale_quantity","SALE_SUMMARY_DATA","title","value","totalEachMonthSales","map","monthDate","sale","saleDate","rentIncomeData","datasets","data","label","type","backgroundColor","borderColor","hoverBackgroundColor","hoverBorderColor","labels","totalEachMonthClientMoney","charge","chargeDate","charge_amount","push","pointBorderColor","pointBackgroundColor","pointHoverBackgroundColor","pointHoverBorderColor","values","setFilteredSaleItemsByYear","parseInt","handleSubmit","touched","errors","handleChange","handleBlur","form","unitOccupancyData","index","mapStateToProps","state"],"mappings":"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","sourcesContent":["import React, { useEffect, useState } from \"react\";\nimport Layout from \"../components/PrivateLayout\";\nimport { connect } from \"react-redux\";\nimport PageHeading from \"../components/PageHeading\";\nimport InfoDisplayPaper from \"../components/InfoDisplayPaper\";\nimport Grid from \"@material-ui/core/Grid\";\nimport Typography from \"@material-ui/core/Typography\";\nimport Box from \"@material-ui/core/Box\";\nimport MenuItem from \"@material-ui/core/MenuItem\";\nimport Button from \"@material-ui/core/Button\";\nimport TextField from \"@material-ui/core/TextField\";\nimport SearchIcon from \"@material-ui/icons/Search\";\nimport { Bar } from 'react-chartjs-2';\nimport { commonStyles } from '../components/commonStyles'\nimport * as Yup from \"yup\";\nimport { Formik } from \"formik\";\nimport { format, getYear, startOfYear, endOfYear, startOfToday, parse, eachMonthOfInterval, isSameMonth } from \"date-fns\";\nimport { getUnitTypes } from \"../assets/commonAssets\";\n\n\nconst options = {\n  responsive: true,\n  tooltips: {\n    mode: 'label'\n  },\n  elements: {\n    line: {\n      fill: false\n    }\n  },\n  scales: {\n    yAxes: [\n      {\n        ticks: {\n          min: 0,\n        }\n      }\n    ],\n  }\n};\n\nconst FilterYearSchema = Yup.object().shape({\n  filter_year: Yup.number()\n    .typeError(\"Year must be a number!\")\n    .required(\"Year is required\")\n    .min(2000, \"Sorry, were not present then.\")\n    .max(2100, \"Sorry, but we won't be here during those times.\")\n    .integer(),\n});\n\nvar monthsInYear = eachMonthOfInterval({\n  start: startOfYear(startOfToday()),\n  end: endOfYear(startOfToday()),\n})\n\n//get the various unit types \nconst UNIT_TYPES = getUnitTypes();\n\nconst currentYear = new Date().getFullYear()\n\nlet DashBoardPage = (props) => {\n  const classes = commonStyles()\n  const { sales, customerAccountDeposits } = props;\n  const [transactionItems, setSaleItems] = useState([]);\n  const [propertyUnitItems, setPropertyUnitItems] = useState([]);\n  const [leaseItems, setLeaseItems] = useState([]);\n  const [chargesItems, setChargesItems] = useState([]);\n  const propertyActiveLeases = leaseItems.filter(({ terminated }) => terminated !== true)\n\n  useEffect(() => {\n    const rentalChargesForCurrentYear = rentalCharges\n      .filter(({ charge_date }) => getYear(parse(charge_date, 'yyyy-MM-dd', new Date())) === currentYear)\n    setChargesItems(rentalChargesForCurrentYear);\n  }, [rentalCharges]);\n\n  useEffect(() => {\n    const salesPaymentsForCurrentYear = sales\n      .filter(({ sale_date }) => getYear(parse(sale_date, 'yyyy-MM-dd', new Date())) === currentYear)\n    setSaleItems(salesPaymentsForCurrentYear);\n  }, [sales]);\n\n\n  //GET THE TOTAL NUMBER OF PROPERTY UNITS\n  const TOTAL_SALES = sales.reduce((total, currentSale) =>\n    total + ((parseFloat(currentSale.sale_price) * parseFloat(currentSale.sale_quantity)) || 0), 0);\n\n\n  // CREATE A UNIT OCCUPANCY DISPLAY DATA ARRAY INSTEAD OF REPEATING MULTIPLE ELEMENTS\n  const SALE_SUMMARY_DATA = [\n    { title: \"Total Sales\", value: TOTAL_SALES },\n    { title: \"Total Credit\", value: 0 },\n  ]\n\n  //GET THE TOTAL PAYMENTS FOR EACH MONTH IN THE SELECTED YEAR\n  const totalEachMonthSales = monthsInYear.map((monthDate) => {\n    //get sales recorded in the same month and year as monthDate\n    return sales\n      .filter((sale) => {\n        const saleDate = parse(sale.sale_date, 'yyyy-MM-dd', new Date())\n        return isSameMonth(monthDate, saleDate)\n      }).reduce((total, currentSale) =>\n\n        total + ((parseFloat(currentSale.sale_price) * parseFloat(currentSale.sale_quantity)) || 0), 0)\n  })\n  // MAKE AN OBJECT FOR SHOWING AN INCOME GRAPH, BY MONTH, LATER\n  // LABELS ARE MONTHS IN THE YEAR IN SHORT FORMAT\n  const rentIncomeData = {\n    datasets: [{\n      data: totalEachMonthSales, label: 'Monthly Sales', type: 'bar',\n      fill: false,\n      backgroundColor: '#71B37C',\n      borderColor: '#71B37C',\n      hoverBackgroundColor: '#71B37C',\n      hoverBorderColor: '#71B37C',\n    }],\n    labels: monthsInYear.map((monthDate) => format(monthDate, 'MMMM')),\n  }\n\n  const totalEachMonthClientMoney = monthsInYear.map((monthDate) => {\n    //get sales recorded in the same month and year as monthDate\n    return customerAccountDeposits\n      .filter((charge) => {\n        const chargeDate = parse(charge.charge_date, 'yyyy-MM-dd', new Date())\n        return isSameMonth(monthDate, chargeDate)\n      }).reduce((total, currentSale) => total + (parseFloat(currentSale.charge_amount) || 0), 0)\n  })\n  rentIncomeData.datasets.push({\n    data: totalEachMonthClientMoney,\n    label: 'Monthly Charges', type: 'line', borderColor: '#EC932F', fill: false,\n    backgroundColor: '#EC932F',\n    pointBorderColor: '#EC932F',\n    pointBackgroundColor: '#EC932F',\n    pointHoverBackgroundColor: '#EC932F',\n    pointHoverBorderColor: '#EC932F',\n  })\n\n  return (\n    <Layout pageTitle=\"Overview\">\n      <Grid container justify=\"center\" direction=\"column\" spacing={4}>\n        <Grid item key={0}>\n          <PageHeading text={\"Overview\"} />\n        </Grid>\n        <Grid item container>\n          <Grid container item direction=\"column\" spacing={4}>\n            <Grid item>\n              <Box\n                border={1}\n                borderRadius=\"borderRadius\"\n                borderColor=\"grey.400\"\n              >\n                <Formik\n                  initialValues={{ filter_year: currentYear }}\n                  validationSchema={FilterYearSchema}\n                  onSubmit={(values) => {\n                    setFilteredSaleItemsByYear(parseInt(values.filter_year));\n                  }}\n                >\n                  {({\n                    values,\n                    handleSubmit,\n                    touched,\n                    errors,\n                    handleChange,\n                    handleBlur,\n                  }) => (\n                    <form\n                      className={classes.form}\n                      id=\"yearFilterForm\"\n                      onSubmit={handleSubmit}\n                    >\n                      <Grid\n                        container\n                        spacing={2}\n                        alignItems=\"center\"\n                        justify=\"center\"\n                        direction=\"row\"\n                      >\n                        <Grid item>\n                          <TextField\n                            variant=\"outlined\"\n                            id=\"filter_year\"\n                            name=\"filter_year\"\n                            label=\"Year\"\n                            value={values.filter_year}\n                            onChange={handleChange}\n                            onBlur={handleBlur}\n                            error={errors.filter_year && touched.filter_year}\n                            helperText={\n                              touched.filter_year && errors.filter_year\n                            }\n                          />\n                        </Grid>\n                        <Grid item>\n                          <Button\n                            type=\"submit\"\n                            form=\"yearFilterForm\"\n                            color=\"primary\"\n                            variant=\"contained\"\n                            size=\"medium\"\n                            startIcon={<SearchIcon />}\n                          >\n                            SEARCH\n                          </Button>\n                        </Grid>\n                      </Grid>\n                    </form>\n                  )}\n                </Formik>\n              </Box>\n            </Grid>\n          </Grid>\n        </Grid>\n        <Grid\n          item\n          container\n          spacing={2}\n          direction=\"row\"\n          alignItems=\"stretch\"\n          justify=\"space-around\"\n          key={3}\n        >\n        </Grid>\n        <Grid\n          item\n          container\n          spacing={2}\n          direction=\"row\"\n          alignItems=\"stretch\"\n          justify=\"space-around\"\n          key={2}\n        >\n          {\n            SALE_SUMMARY_DATA.map((unitOccupancyData, index) =>\n              <InfoDisplayPaper key={index} xs={12} title={unitOccupancyData.title} value={unitOccupancyData.value} />\n            )\n          }\n        </Grid>\n        <Grid item>\n          <Typography variant=\"h6\" align=\"center\" gutterBottom>\n            Monthly Sales &amp; Credit\n          </Typography>\n          <Bar\n            data={rentIncomeData}\n            options={options}>\n          </Bar>\n        </Grid>\n      </Grid>\n    </Layout>\n  );\n};\n\nconst mapStateToProps = (state) => {\n  return {\n    customerAccountDeposits: state.customerAccountDeposits,\n    sales: state.sales,\n  };\n};\n\nexport default connect(mapStateToProps)(DashBoardPage);\n"]},"metadata":{},"sourceType":"module"}